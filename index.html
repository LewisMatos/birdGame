<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
    <style>
      :root{
        box-sizing: border-box;
      }
      body{
        margin: 0;
        padding: 0;
        overflow:hidden;
      }
      .hide {
        display: none;
      }

      .gameArea {
        background-color: skyblue;
        width: 100%;
        height: 100%;
        margin: auto;
        overflow:hidden;
      }

      .score {
        position: absolute;
        width: 100%;
        z-index: 100;
        color: black;
        text-align: center;
        height: 50px;
        font-size: 3.5em;
        font-family: fantasy;
        text-align: center;
      }

      .startScreen {
        position: absolute;
        background-color: red;
        left: 25%;
        top: 100px;
        color: white;
        width: 50%;
        padding: 15px;
        border: 1px solid black;
        text-align: center;
      }

      .bird {
        position: absolute;
        top: 100px;
        left: 56px;
        width: 57px;
        height: 40px;
        line-height: 40px;
        font-size: 1.5em;
        background-image: url(bird.png);
        background-size: cover;
      }

      .wing {
        position: absolute;
        top: 10px;
        left: 0px;
        background-color: #d4bf27;
        width: 20px;
        height: 10px;
        border-radius: 11px;
        border: 2px solid black;
      }

      .gameMessage {
        position: absolute;
        top: 10%;
        text-align: center;
        left: 20%;
        width: 60%;
        background-color: aliceblue;
        font-size: 2em;
        z-index:100;
      }
      .pipe {
        width: 100px;
        position: absolute;
        text-align: center;
      }


 .slide-bottom {
	animation-duration: 3s;
  animation-name: slidein;
}
@keyframes slidein {
  to {
    transform: translateY(0)
  }
  5%{
    transform: rotate(180deg)
  }
  70%{
    transform: translateY(900px)
  }
  100%{
    display:none;
  }
}


    </style>
  </head>

  <body>
    <div class="score"></div>
    <div class="game">
      <span class="gameMessage hide"></span>
      <div class="startScreen">Press Start</div>
      <div class="gameArea"></div>
    </div>
    <script>
      const score = document.querySelector('.score');
      const startScreen = document.querySelector('.startScreen');
      const gameArea = document.querySelector('.gameArea');
      const gameMessage = document.querySelector('.gameMessage');
      gameMessage.addEventListener('click', start);
      startScreen.addEventListener('click', start);
      document.addEventListener('keydown', pressOn);
      document.addEventListener('keyup', pressOff);
      let keys = {};
      let player = {};
      function start() {
        player.speed = 5;
        player.score = 0;
        player.inplay = true;
        gameArea.innerHTML = '';
        gameMessage.classList.add('hide');
        startScreen.classList.add('hide');
        let bird = document.createElement('div');
        bird.setAttribute('class', 'bird');
        let wing = document.createElement('span');
        wing.setAttribute('class', 'wing');
        wing.pos = 15;
        wing.style.top = wing.pos + 'px';
        bird.appendChild(wing);
        gameArea.appendChild(bird);
        player.x = bird.offsetLeft;
        player.y = bird.offsetTop;

        player.pipe = 0;
        let spacing = 300;
        let howMany = Math.floor(gameArea.offsetWidth / spacing);
        for (let x = 0; x < howMany; x++) {
          buildPipes(player.pipe * spacing);
        }

        window.requestAnimationFrame(playGame);
      }

      function buildPipes(startPos) {
        let totalHeight = gameArea.offsetHeight;
        let totalWidth = gameArea.offsetWidth;
        player.pipe++;
        let pipecolor = getRandomColor();
        let pipe1 = document.createElement('div');
        pipe1.start = startPos + totalWidth;
        pipe1.classList.add('pipe');
        pipe1.innerHTML = '<br>';
        pipe1.height = Math.floor(Math.random() * 350);
        pipe1.style.height = pipe1.height + 'px';
        pipe1.style.left = pipe1.start + 'px';
        pipe1.style.top = '0px';
        pipe1.x = pipe1.start;
        pipe1.id = player.pipe;
        pipe1.style.backgroundColor = pipecolor;
        gameArea.appendChild(pipe1);

        let pipeSpace = Math.floor(Math.random() * 250) + 150;
        let pipe2 = document.createElement('div');
        pipe2.start = pipe1.start;
        pipe2.classList.add('pipe');
        pipe2.innerHTML = '<br>';
        pipe2.style.height = totalHeight - pipe1.height - pipeSpace + 'px';
        pipe2.style.left = pipe1.start + 'px';
        pipe2.style.bottom = '0px';
        pipe2.x = pipe1.start;
        pipe2.id = player.pipe;
        pipe2.style.backgroundColor = pipecolor;
        gameArea.appendChild(pipe2);
      }

      function movePipes(bird) {
        let lines = document.querySelectorAll('.pipe');
        let counter = 0;
        lines.forEach(function(item) {
          console.log(item);
          item.x -= player.speed;
          item.style.left = item.x + 'px';
          if (item.x < 0) {
            item.parentElement.removeChild(item);
            counter++;
          }
          if (isCollide(item, bird)) {
            playGameOver(bird);
          }
        });
        counter = counter / 2;
        for (let x = 0; x < counter; x++) {
          buildPipes(0);
        }
      }

      function isCollide(a, b) {
        let aRect = a.getBoundingClientRect();
        let bRect = b.getBoundingClientRect();

        return !(
          aRect.bottom < bRect.top || aRect.top > bRect.bottom || aRect.right < bRect.left || aRect.left > bRect.right
        );
      }

      function playGame() {
        if (player.inplay) {
          let bird = document.querySelector('.bird');
          let wing = document.querySelector('.wing');
          movePipes(bird);
          let move = false;
          if (keys.ArrowLeft && player.x > 0) {
            player.x -= player.speed;
            move = true;
          }
          if (keys.ArrowRight && player.x < gameArea.offsetWidth - 56) {
            player.x += player.speed;
            move = true;
          }
          if (keys.ArrowUp || (keys.Space && player.y > 0)) {
            player.y -= player.speed * 3;
            move = true;
          }
          if (keys.ArrowDown && player.y < gameArea.offsetHeight - 56) {
            player.y += player.speed;
            move = true;
          }
          if (move) {
            wing.pos = wing.pos == 15 ? 22 : 15;
            wing.style.top = wing.pos + 'px';
          }
          player.y += player.speed *1;
          if (player.y > gameArea.offsetHeight) {
            console.log('game over');
            playGameOver(bird);
          }
          bird.style.top = player.y + 'px';
          bird.style.left = player.x + 'px';
          window.requestAnimationFrame(playGame);
          player.score++;
          score.innerText = 'Score.' + player.score;
        }
      }

      function playGameOver(bird) {
        player.inplay = false;
        gameMessage.classList.remove('hide');
        bird.classList.add("slide-bottom");
        setTimeout(function(){
          bird.style.display = "none"
          gameMessage.innerHTML = 'Game over<br>you scored ' + player.score + '<br>Click here to start again';
        },1000)

      }

      function pressOn(e) {
        e.preventDefault();
        keys[e.code] = true;
      }
      function pressOff(e) {
        e.preventDefault();
        keys[e.code] = false;
      }

      function getRandomColor() {
        var letters = '0123456789ABCDEF';
        var color = '#';
        for (var i = 0; i < 6; i++) {
          color += letters[Math.floor(Math.random() * 16)];
        }
        return color;
      }




    </script>
  </body>
</html>
